---
layout: default
---
<article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">{{ page.title | escape }}</h1>
    <p class="post-meta">
      <time datetime="{{ page.date | date_to_xmlschema }}" itemprop="datePublished">
        {{ page.date | date: "%B %-d, %Y" }}
      </time>
      {% if page.author %}
        â€¢ <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">{{ page.author }}</span></span>
      {% endif %}
    </p>
    {% if page.description %}
    <p class="post-description">{{ page.description }}</p>
    {% endif %}
  </header>

  <div class="post-layout">
    <div class="post-main">
      <div class="post-content" itemprop="articleBody">
        {{ content }}
      </div>
    </div>

    <aside class="post-toc" aria-label="On this page">
      <div class="toc-inner wrapper">
        <h4>On this page</h4>
        <nav id="post-toc"></nav>
      </div>
    </aside>
  </div>

  <script>
    (function(){
      // Build TOC from h2/h3 inside the post-content
      var container = document.getElementById('post-toc');
      if(!container) return;
      var content = document.querySelector('.post-content');
      if(!content) return;
      var headings = content.querySelectorAll('h2, h3');
      if(!headings.length) { container.innerHTML = '<p>No sections</p>'; return; }

      var ul = document.createElement('ul');
      ul.className = 'toc-list';
      var lastLiH2 = null;

      function slug(text){
        return text.toLowerCase().replace(/[^a-z0-9]+/g,'-').replace(/^-|-$/g,'');
      }

      headings.forEach(function(h){
        if(!h.id) h.id = slug(h.textContent || h.innerText || 'section');
        var a = document.createElement('a');
        a.href = '#' + h.id;
        a.textContent = h.textContent || h.innerText;
        a.className = h.tagName.toLowerCase() === 'h2' ? 'toc-link h2' : 'toc-link h3';

        var li = document.createElement('li');
        li.appendChild(a);

        if(h.tagName.toLowerCase() === 'h2'){
          ul.appendChild(li);
          lastLiH2 = li;
          li.classList.add('h2-item');
        } else {
          // h3 -> indent under last h2
          var sub = lastLiH2 && lastLiH2.querySelector('ul');
          if(!sub){ sub = document.createElement('ul'); sub.className='toc-sub'; lastLiH2 && lastLiH2.appendChild(sub); }
          sub.appendChild(li);
        }
      });

      container.appendChild(ul);

      // For small screens, inject a collapsible TOC at the top of the post content
      if(window.innerWidth <= 900){
        try{
          var details = document.createElement('details');
          details.className = 'toc-mobile callout';
          var summary = document.createElement('summary');
          summary.textContent = 'On this page';
          details.appendChild(summary);
          var clone = ul.cloneNode(true);
          details.appendChild(clone);
          content.insertBefore(details, content.firstChild);
          // Hide the aside (desktop) TOC if present
          var aside = document.querySelector('.post-toc');
          if(aside) aside.style.display = 'none';
        }catch(e){ /* ignore */ }
      }

      // Highlight active heading and show subheadings under current h2
      var links = document.querySelectorAll('a.toc-link');
      var idToLinks = {};
      links.forEach(function(l){ var id = l.getAttribute('href').slice(1); if(!idToLinks[id]) idToLinks[id] = []; idToLinks[id].push(l); });

      // Build map of h2 ids to their heading elements
      var h2Map = {};
      content.querySelectorAll('h2').forEach(function(h2){ h2Map[h2.id] = h2; });

      var observer = new IntersectionObserver(function(entries){
        var currentSection = null;
        var currentSubsection = null;

        // Find which h2 section and h3 subsection we're currently in (based on vertical position)
        headings.forEach(function(h){
          var rect = h.getBoundingClientRect();
          if(rect.top < window.innerHeight / 2){
            if(h.tagName.toLowerCase() === 'h2'){
              currentSection = h.id;
            } else if(h.tagName.toLowerCase() === 'h3'){
              currentSubsection = h.id;
            }
          }
        });

        // Clear all active classes
        links.forEach(function(x){ x.classList.remove('active'); });
        document.querySelectorAll('.h2-item').forEach(function(li){ li.classList.remove('h2-active'); });

        // Set h2-active for current section and highlight h2 (apply to all matching TOC instances)
        if(currentSection){
          // add active to all links for this id
          if(idToLinks[currentSection]){
            idToLinks[currentSection].forEach(function(link){ link.classList.add('active'); });
          }
          // mark parent li.h2-item elements that contain this link
          document.querySelectorAll('li.h2-item').forEach(function(li){ if(li.querySelector('a[href="#'+currentSection+'"]')) li.classList.add('h2-active'); });
        }

        // Highlight current h3 subsection if in one (apply to all matching links)
        if(currentSubsection){
          if(idToLinks[currentSubsection]){
            idToLinks[currentSubsection].forEach(function(link){ link.classList.add('active'); });
          }
        } else if(currentSection){
          // If no h3, just keep h2 highlighted (already done above)
        }
      },{ root:null, rootMargin:'0px 0px 0px 0px', threshold:0 });

      headings.forEach(function(h){ observer.observe(h); });

    })();
  </script>

</article>
